<ng-template #modalContent let-modal>
  <div class="modal-header">
    <h4 class="modal-title">{{character.name}}</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
      <img src="assets/images/personal-goals/pg-{{character.personalQuest.id}}.png">
  </div>
</ng-template>

<ng-template #shopModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title">Shop - {{selectedSlotType | titlecase}}</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="shop-info">
      <p><strong>Character Gold:</strong> {{character.gold}}</p>
      <p *ngIf="priceModifier !== 0" [class.text-danger]="priceModifier > 0" [class.text-success]="priceModifier < 0">
        <strong>Price Modifier:</strong> {{priceModifier > 0 ? '+' : ''}}{{priceModifier}}
      </p>
    </div>
    <div class="shop-items-grid">
      <div *ngFor="let item of shopItems" class="shop-item-wrapper">
        <img 
          [src]="'assets/images/' + item.image" 
          [class.out-of-stock]="item.isOutOfStock"
          [class.insufficient-gold]="!item.canAfford && !item.isOutOfStock"
          [title]="item.name + ' - ' + item.adjustedPrice + ' gold'"
          class="shop-item-img">
        <div class="item-price" [class.too-expensive]="!item.canAfford">
          {{item.adjustedPrice}}g
        </div>
        <div class="item-status" *ngIf="item.isOutOfStock">Out of Stock</div>
        <div class="item-status insufficient" *ngIf="!item.canAfford && !item.isOutOfStock">Not enough gold</div>
      </div>
    </div>
    <div *ngIf="shopItems.length === 0" class="no-items">
      No items available for this slot.
    </div>
  </div>
</ng-template>

<div class="player-sheet">
  <!-- Character Name Header -->
  <div class="player-name">{{character.name}}</div>
  
  <div class="player-content">
    <!-- Left: Character Image -->
    <div class="player-img">
      <img class="character" src="./assets/{{character.characterClass.image}}" />
    </div>

    <!-- Right: Stats Card -->
    <div class="stats-card">
      <div class="stat-row class-info">
        <span class="stat-label">{{character.characterClass.race}} {{character.characterClass.className}}</span>
      </div>
      
      <div class="stat-row">
        <span class="stat-label">Level:</span>
        <span class="stat-value">{{character.level}}</span>
      </div>
      
      <div class="stat-row">
        <span class="stat-label">XP:</span>
        <span class="stat-value">{{character.experience}}</span>
      </div>
      
      <div class="stat-row">
        <span class="stat-label">Gold:</span>
        <span class="stat-value">{{character.gold}}</span>
      </div>
      
      <div class="stat-row">
        <span class="stat-label">Perk Ticks:</span>
        <span class="stat-value">{{character.perkTicks}}</span>
      </div>
      
      <div class="stat-row personal-quest">
        <span class="stat-label">Personal Quest:</span>
        <div class="quest-details">
          {{character.personalQuest.title}} 
          <span class="progress">({{character.personalQuest.progress}} / {{character.personalQuest.total}})</span>
          <span class="view-icon" (click)="openPQModal(modalContent)">
            <svg class="bi bi-eye-fill" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path d="M10.5 8a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
              <path fill-rule="evenodd" d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 100-7 3.5 3.5 0 000 7z" clip-rule="evenodd"/>
            </svg>
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Equipment Grid -->
  <div class="equipment-section">
    <h3 class="section-title">Equipment</h3>
    
    <div class="equipment-grid">
      <!-- Head Slot -->
      <div class="equipment-slot head clickable" (click)="openShopModal('head', shopModal)">
        <div class="slot-label" *ngIf="!getItemForSlot('head')">Head</div>
        <img *ngIf="getItemForSlot('head')" [src]="'assets/images/' + getItemForSlot('head')!.image" class="item-img">
        <div *ngIf="!getItemForSlot('head')" class="empty-slot">Empty</div>
      </div>

      <!-- Left Hand Slot -->
      <div class="equipment-slot hand-left clickable" (click)="openShopModal(getTwoHandedItem() ? 'two-hands' : 'one-hand', shopModal)">
        <div class="slot-label" *ngIf="!getTwoHandedItem() && !getOneHandItems()[0]">Left Hand</div>
        <img *ngIf="getTwoHandedItem()" [src]="'assets/images/' + getTwoHandedItem()!.image" class="item-img">
        <img *ngIf="!getTwoHandedItem() && getOneHandItems()[0]" [src]="'assets/images/' + getOneHandItems()[0].image" class="item-img">
        <div *ngIf="!getTwoHandedItem() && !getOneHandItems()[0]" class="empty-slot">Empty</div>
      </div>

      <!-- Body Slot -->
      <div class="equipment-slot body clickable" (click)="openShopModal('body', shopModal)">
        <div class="slot-label" *ngIf="!getItemForSlot('body')">Body</div>
        <img *ngIf="getItemForSlot('body')" [src]="'assets/images/' + getItemForSlot('body')!.image" class="item-img">
        <div *ngIf="!getItemForSlot('body')" class="empty-slot">Empty</div>
      </div>

      <!-- Right Hand Slot -->
      <div class="equipment-slot hand-right clickable" (click)="openShopModal('one-hand', shopModal)">
        <div class="slot-label" *ngIf="!getTwoHandedItem() && !getOneHandItems()[1]">Right Hand</div>
        <img *ngIf="!getTwoHandedItem() && getOneHandItems()[1]" [src]="'assets/images/' + getOneHandItems()[1].image" class="item-img">
        <div *ngIf="!getTwoHandedItem() && !getOneHandItems()[1]" class="empty-slot">Empty</div>
        <div *ngIf="getTwoHandedItem()" class="empty-slot disabled">-</div>
      </div>

      <!-- Legs Slot -->
      <div class="equipment-slot legs clickable" (click)="openShopModal('legs', shopModal)">
        <div class="slot-label" *ngIf="!getItemForSlot('legs')">Legs</div>
        <img *ngIf="getItemForSlot('legs')" [src]="'assets/images/' + getItemForSlot('legs')!.image" class="item-img">
        <div *ngIf="!getItemForSlot('legs')" class="empty-slot">Empty</div>
      </div>
    </div>

    <!-- Small Items Section -->
    <div class="small-items-section" *ngIf="getSmallItems().length > 0">
      <h4 class="subsection-title">Small Items</h4>
      <div class="small-items-container">
        <img *ngFor="let item of getSmallItems()" [src]="'assets/images/' + item.image" class="small-item-img">
      </div>
    </div>
  </div>
</div>
